{% extends 'base.html' %}
{% block content %}
<div class="card card-sport p-4 mb-4">
  <div class="d-flex justify-content-between">
    <div>
      <h1 class="h3">{{ ride.title }}</h1>
      <p class="mb-1">{{ ride.date }} • {{ ride.start_time|time:'H:i' }} • {{ ride.departure }}</p>
      <p class="mb-1">{{ ride.distance_km }} km • {{ ride.get_level_display }}</p>
      <p class="text-muted">{{ ride.notes|default:'Geen notities' }}</p>
    </div>
    <div class="text-end">
      <span class="badge bg-dark">{{ ride.status }}</span>
      {% if user == ride.created_by or user.is_staff %}
      <div class="mt-2 d-grid gap-2">
        <a href="{% url 'ride_edit' ride.pk %}" class="btn btn-sm btn-outline-primary">Bewerk</a>
        <a href="{% url 'ride_process' ride.pk %}" class="btn btn-sm btn-outline-success">Na-rit verwerking</a>
      </div>
      {% endif %}
    </div>
  </div>
  <div class="mt-3 d-flex gap-2">
    <form method="post" action="{% url 'ride_signup' ride.pk %}">{% csrf_token %}<button class="btn btn-primary">Inschrijven</button></form>
    <form method="post" action="{% url 'ride_unsubscribe' ride.pk %}">{% csrf_token %}<button class="btn btn-outline-danger">Uitschrijven</button></form>
  </div>
  {% if my_participation %}
  <div class="mt-3">
    <form method="post" action="{% url 'ride_finish_self' ride.pk %}" class="row g-2 align-items-end">{% csrf_token %}
      <div class="col-md-3">{{ finish_form.km.label_tag }}{{ finish_form.km }}</div>
      <div class="col-md-3"><button class="btn btn-success">Ik heb uitgereden</button></div>
    </form>
  </div>
  {% endif %}
</div>

<h2 class="h5">Deelnemers ({{ participations|length }})</h2>
<div class="table-responsive">
<table class="table table-hover">
<tr><th>Naam</th><th>Status</th><th>Km</th></tr>
{% for p in participations %}
<tr><td><a href="{% url 'profile_detail' p.user.username %}">{{ p.user.display_name }}</a></td><td><span class="badge bg-info status-badge">{{ p.get_status_display }}</span></td><td>{{ p.km }}</td></tr>
{% empty %}<tr><td colspan="3">Nog geen deelnemers.</td></tr>{% endfor %}
</table>
</div>
{% endblock %}
